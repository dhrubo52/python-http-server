<!DOCTYPE html>
<html>
    <head>
        <style>
            * {
                box-sizing: border-box;
                padding: 0;
            }

            #file-container {
                margin: 20px 0 0 0;
                display: grid;
                grid-template-columns: repeat(2, auto);
                width: fit-content;
                gap: 10px;
            }

            input + input {
                margin: 10px 0 0 0;
            }

            .button {
                padding: 5px;
            }
        </style>

        <title>
            Hello World
        </title>
    </head>
    <body>
        <h2>
            Hi, You are in upload file page!
        </h2>

        <a href="http://127.0.0.1:8000/">Home</a>
        <a style="margin: 0px 20px;" href="http://127.0.0.1:8000/upload-file.html">Upload File</a>
        <a href="http://127.0.0.1:8000/about.html">About</a>
        
        <form 
            id="file_form"
            style="margin: 10px 0 0 0;"
            action="http://127.0.0.1:8000/" 
            method="POST" 
            enctype="multipart/form-data"
        >
            <input type="file" name="file">
            <button type="submit" form="file_form">Submit</button>
        </form>

        <div id="file-container">

        </div>

        <script>
            function enableEdit(button, input) {
                let inputValues = input.value.split(".");
                input.setAttribute("data-old-name", input.value);
                input.value = inputValues[0];
                input.setAttribute("data-file-type", inputValues[1]);
                input.disabled = false;
                button.textContent = "Submit";
            }

            function disableEdit(button, input) {
                input.value = `${input.value}.${input.dataset.fileType}`;
                input.disabled = true;
                button.textContent = "Edit File Name";
            }

            fetch("http://127.0.0.1:8000/?file-list=true")
            .then((response)=>{
                return response.json();
            })
            .then((data)=>{
                let media_file_list = data.media_file_list;
                let file_container = document.getElementById("file-container");

                for(let i=0; i<media_file_list.length; ++i) {
                    let input = document.createElement("input");
                    input.id = `input-${i}`;
                    input.type = "text";
                    input.value = media_file_list[i];
                    input.disabled = true;
                    file_container.appendChild(input);
                    
                    let editButton = document.createElement("button");
                    editButton.id = `${i}`;
                    editButton.textContent = "Edit File Name";
                    editButton.classList.add("button");
                    editButton.addEventListener("click", (e)=>{
                        let button = e.target;
                        if(button.textContent==="Edit File Name") {
                            enableEdit(button, input);
                        }
                        else {
                            // disableEdit(button, input);
                            updateFileName(button, input);
                        }
                    })
                    file_container.appendChild(editButton);

                    let cancelButton = document.createElement("button");
                    cancelButton.id = `cancel-${i}`;
                    
                }
            })

            function updateFileName(button, input) {
                let request = new XMLHttpRequest();
                request.open("PUT", "http://127.0.0.1:8000", true);
                request.setRequestHeader("Content-Type", "application/json");

                let data = JSON.stringify({
                    "old_name": input.dataset.oldName,
                    "new_name": `${input.value}.${input.dataset.fileType}`
                })

                request.send(data);

                request.onload = () => {
                    if(request.status==200) {
                        window.location.href = "http://127.0.0.1:8000/upload-file.html";
                    }
                }
            }
        </script>
    </body>
</html>